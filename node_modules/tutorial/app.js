
var express = require('express');
var bodyParser = require('body-parser');
var fs = require("fs");
var multer = require('multer');

var app = express();
var urlEncodedParser = bodyParser.urlencoded({extended : false });   // برای  زمانی که متد ارسالی از نوع پست باشد
app.use(express.static('public'));
var upload = multer({ dest: 'uploads/' })      // File Upload


app.get('/', function (req, res) {
    res.send('Hello World');
});


app.get('/index.html' , function(req , res){
    res.sendfile( __dirname + '/' + 'index.html');
});
//
// app.post('/process' , urlEncodedParser , function(req , res) {         // بخش دوم برای این است که بتوانیم به مقدار قابل مشاهده تبدیل کنیم
//      // return Json Format to consol
//      response = {
//          // when use get :: query
//          // when use post :: body
//          firstname:req.body.firstname,
//          lastname:req.body.lastname,
//      };
//
//      console.log(response);
//      res.end(JSON.stringify(response));
// });
//

 // Upload Files

app.post('/upload' , function(req , res) {
    // File upload code here ///
     console.log(req.files.file.name);   // req.files :: property && file :: name in index.html
     console.log(req.files.file.path);
     console.log(req.files.file.type);

     var file = __dirname + "/" + req.files.file.name ;
     fs.readFile( req.files.file.path , function(err , data) {
             if(err) {console.log(err)}

                 else {
                        report = {
                            massage : 'File upload successfully' ,
                            filename : req.files.file.name
                        }
                 }
                 console.log(report);
                 res.end(JSON.stringify(report));
     });
});


var server = app.listen(8081, function () {

    var host = server.address().address
    var port = server.address().port

    console.log("Example app listening at : ", host, port)
})
